---
title: ç”¨Node.jså¯¦ä½œç¬¬ä¸‰æ–¹ç™»å…¥- Google
description: >-
  ç•¶æˆ‘å€‘è¦åœ¨ç¶²é è¨»å†Šæœƒå“¡æ™‚ï¼Œç›¸ä¿¡è¶Šä¾†è¶Šå¤šäººæœƒé¸æ“‡ç¬¬ä¸‰æ–¹ç™»å…¥ï¼Œä¸ç”¨å†å¤šè·‘ä¸€æ¬¡ç¹ç‘£çš„è¨»å†Šæµç¨‹ï¼Œä¹Ÿä¸éœ€è¦å¤šè¨˜ä¸€çµ„å¸³è™Ÿå¯†ç¢¼ï¼Œæ–¹ä¾¿è¨±å¤šï¼Œå› æ­¤ç›®å‰è »å¤šç¶²ç«™éƒ½æœ‰æä¾›ç¬¬ä¸‰æ–¹ç™»å…¥çš„æœå‹™ï¼Œå°±æ˜¯ç‚ºäº†è¦ç•™ä½é€™äº›"éå®¢"ï¼Œæ—¢ç„¶é€™å·²ç¶“æˆäº†è¨±å¤šç¶²ç«™çš„æ¨™æº–é…å‚™ï¼Œå‰›å¥½è¿‘æœŸæœ‰åœ¨åšsideProjectï¼Œé‚£å°±ä¾†å¯¦ä½œçœ‹çœ‹â€¦
date: '2022-09-30T02:24:28.253Z'
categories: []
keywords: []
slug: >-
  /@joe-chang/%E7%94%A8node-js%E5%AF%A6%E4%BD%9C%E7%AC%AC%E4%B8%89%E6%96%B9%E7%99%BB%E5%85%A5-google-1e6962aafbfc
---

![](/Users/joectchang_mac/Downloads/medium-export-a/post2022/md_1697073583233/img/1__Eqn1tUURnxY18OLYK092CQ.jpeg)

ç•¶æˆ‘å€‘è¦åœ¨ç¶²é è¨»å†Šæœƒå“¡æ™‚ï¼Œç›¸ä¿¡è¶Šä¾†è¶Šå¤šäººæœƒé¸æ“‡ç¬¬ä¸‰æ–¹ç™»å…¥ï¼Œä¸ç”¨å†å¤šè·‘ä¸€æ¬¡ç¹ç‘£çš„è¨»å†Šæµç¨‹ï¼Œä¹Ÿä¸éœ€è¦å¤šè¨˜ä¸€çµ„å¸³è™Ÿå¯†ç¢¼ï¼Œæ–¹ä¾¿è¨±å¤šï¼Œå› æ­¤ç›®å‰è »å¤šç¶²ç«™éƒ½æœ‰æä¾›ç¬¬ä¸‰æ–¹ç™»å…¥çš„æœå‹™ï¼Œå°±æ˜¯ç‚ºäº†è¦ç•™ä½é€™äº›"éå®¢"ï¼Œæ—¢ç„¶é€™å·²ç¶“æˆäº†è¨±å¤šç¶²ç«™çš„æ¨™æº–é…å‚™ï¼Œå‰›å¥½è¿‘æœŸæœ‰åœ¨åšsideProjectï¼Œé‚£å°±ä¾†å¯¦ä½œçœ‹çœ‹å§!

#### åœ¨GCPå»ºç«‹æ–°å°ˆæ¡ˆ

é¦–å…ˆé€²åˆ° [Google Cloud Platform](https://console.cloud.google.com/)é é¢ï¼Œé»æ“Šå·¦ä¸Šè§’çš„å°ˆæ¡ˆåç¨±ï¼Œæœƒé–‹å•Ÿå½ˆçª—ï¼Œå†é»æ“Šå½ˆçª—å…§æ–°å¢å°ˆæ¡ˆçš„æŒ‰éˆ•

![](/Users/joectchang_mac/Downloads/medium-export-a/post2022/md_1697073583233/img/1__4s023CLM15OzM3Lb3A1t7g.jpeg)

å°ˆæ¡ˆåç¨±å¯è‡ªè¡Œå‘½å

![](/Users/joectchang_mac/Downloads/medium-export-a/post2022/md_1697073583233/img/1__rNTYb10DjeDZGK7uBhHc0w.png)

å»ºç«‹ä¹‹å¾Œï¼Œè®“å­å½ˆé£›ä¸€æœƒï¼Œå³ä¸Šè§’å°±æœƒé¡¯ç¤ºå°ˆæ¡ˆå·²å»ºç«‹å®Œæˆ

![](/Users/joectchang_mac/Downloads/medium-export-a/post2022/md_1697073583233/img/1__Al6H9z9jPHnNmCDabwm1fA.png)

#### è¨­å®šOAuthåŒæ„ç•«é¢

æ‰“é–‹å´é‚Šé¸å–®ï¼Œé¸æ“‡OAuthåŒæ„ç•«é¢

![](/Users/joectchang_mac/Downloads/medium-export-a/post2022/md_1697073583233/img/1__fEM3kVB__qNHnbD6eGBRl3g.png)

æ²’æœ‰æ‰“æ˜Ÿè™Ÿçš„æ¬„ä½å¯ä»¥è·³éä¸ç”¨å¡«

![](/Users/joectchang_mac/Downloads/medium-export-a/post2022/md_1697073583233/img/1__gZqG3HFreUEBEl0zS7am5g.jpeg)

æˆæ¬Šç¶²åŸŸè«‹å¡«å¯«å¾Œç«¯serverçš„ç¶²å€ï¼Œå¯ä»¥è¨­å®šå¤šå€‹(ex.æ­£å¼ç’°å¢ƒã€æ¸¬è©¦ç’°å¢ƒ

![](/Users/joectchang_mac/Downloads/medium-export-a/post2022/md_1697073583233/img/1__msW56w2nucHeE5pINIPR8Q.jpeg)

å¦‚æœæ²’è¨­å®šæˆæ¬Šç¶²åŸŸçš„è©±ç­‰ç­‰è·³è½‰å°±æœƒçœ‹åˆ°é€™å€‹éŒ¯èª¤

![](/Users/joectchang_mac/Downloads/medium-export-a/post2022/md_1697073583233/img/1__R1jXJhJTbQYsfdNldZU2OA.png)

æ¥ä¸‹ä¾†çš„ç¯„åœå’Œæ¸¬è©¦ä½¿ç”¨è€…éƒ½å¯ä¸ç”¨å¡«ï¼Œåˆ°æœ€å¾Œä¸€æ­¥æ‘˜è¦çš„æ™‚å€™å°±ä»£è¡¨OAuthåŒæ„ç•«é¢çš„è¨­å®šå·²ç¶“å®Œæˆ

![](/Users/joectchang_mac/Downloads/medium-export-a/post2022/md_1697073583233/img/1__mw7U0GhllTTebaeq79y4Sg.png)

#### è¨­å®šæ†‘è­‰

é»é–‹å´é‚Šæ¬„ï¼Œé¸æ“‡APIå’Œæœå‹™è£¡é¢çš„æ†‘è­‰

![](/Users/joectchang_mac/Downloads/medium-export-a/post2022/md_1697073583233/img/1__TrlaI7JfIpJBl3Fi7BUqnA.png)

é»æ“Šå»ºç«‹æ†‘è­‰ï¼Œé¸æ“‡OAuthç”¨æˆ¶ç«¯ID

![](/Users/joectchang_mac/Downloads/medium-export-a/post2022/md_1697073583233/img/1__8W52e6BY106REHvU6uI7kw.png)

æ‡‰ç”¨ç¨‹å¼é¡å‹è«‹é¸æ“‡ç¶²é æ‡‰ç”¨ç¨‹å¼ï¼Œåç¨±éš¨æ„ï¼Œå·²æˆæ¬Šçš„é‡æ–°å°å‘URLè«‹è¨­å®šå¾Œç«¯serverçš„urlï¼Œä¹Ÿå°±æ˜¯è¨­å®šç™½åå–®çš„æ„æ€

![](/Users/joectchang_mac/Downloads/medium-export-a/post2022/md_1697073583233/img/1__tDG7ZIM9W87fG34THYrmQw.png)

è¨­å®šå¥½ä¹‹å¾Œå°±æœƒæ‹¿åˆ°ç”¨æˆ¶ç«¯IDå’Œå¯†ç¢¼å›‰! è«‹ä¿ç®¡å¥½ä¸è¦è®“å…¶ä»–äººå–å¾—

![](/Users/joectchang_mac/Downloads/medium-export-a/post2022/md_1697073583233/img/1__f0wolXyj7LEgHgaXmiN39A.jpeg)

ç¶“éä¸€ç•ªæŠ˜é¨°ï¼Œç¸½ç®—æå®šå‰ç½®ä½œæ¥­äº†ï¼Œçµ‚æ–¼å¯ä»¥é–‹å§‹codingå•¦!

#### å¾Œç«¯å¯¦ä½œ

_ä½¿ç”¨Node.js + Passport å¥—ä»¶_

å‡è¨­æˆ‘å€‘ç›´æ¥æŠŠé‡‘é‘°å¯«åœ¨ç¨‹å¼ç¢¼è£¡é¢çš„è©±æœƒæœ‰æš´éœ²çš„é¢¨éšªï¼Œæ‰€ä»¥æˆ‘å€‘ç¿’æ…£å°‡é€™é¡çš„é‡‘é‘°æ”¾åœ¨.envï¼Œ.envè¨˜å¾—è¦åŠ å…¥.gitignoreï¼Œä¸ç„¶pushåˆ°repositoryé‚„æ˜¯ä¸€æ¨£æœƒè¢«çœ‹å…‰å…‰ğŸ˜…

GOOGLE\_CLIENT\_ID=xxxxx  
GOOGLE\_CLIENT\_SECRET=yyyyyy

#### Passport

å¦‚æœè¦æŒ‰éƒ¨å°±ç­çš„ä¸²æ¥googleç™»å…¥ä¹Ÿæ˜¯å¯è¡Œï¼Œä½†éç¨‹æœƒè®Šå¾—æ¯”è¼ƒç¹ç‘£ï¼Œå› æ­¤æœƒæ¨è–¦ä½¿ç”¨Passportå¥—ä»¶ï¼Œå¯ä»¥å¹«æˆ‘å€‘çœä¸‹ä¸å°‘æ™‚é–“ï¼Œé€²åˆ°Passportå®˜ç¶²ï¼Œæœå°‹å°æ‡‰çš„ç­–ç•¥ï¼Œé¸æ“‡ä¸‹è¼‰é‡æœ€å¤šçš„"passport-google-oauth20"

![](/Users/joectchang_mac/Downloads/medium-export-a/post2022/md_1697073583233/img/1__G0EHxUOjgZDRG7PKLwmPYA.png)

å®‰è£Passportå¥—ä»¶

npm install --save passport passport-google-oauth20

å®‰è£å¥½Passportä¹‹å¾Œï¼Œå»ºç«‹ä¸€æ”¯è¨­å®šPassportçš„æª”æ¡ˆï¼Œæª”åéš¨æ„ï¼Œä¸¦ä¸”åœ¨index.jså¼•å…¥(å¦‚æœä¸»ç¨‹å¼åœ¨app.jså°±æ˜¯åœ¨app.jså¼•å…¥)ï¼Œä¸¦ä¸”ä¾ç…§å®˜ç¶²çš„èªªæ˜ï¼Œä½¿ç”¨GoogleStrategyä¸¦ä¸”å¸¶å…¥clientId ã€ clientSecret ä»¥åŠgoogleæˆæ¬ŠæˆåŠŸå¾Œè¦æ‰“çš„ç¶²å€ï¼Œé€™éƒ¨åˆ†ç¨å¾Œæœƒæœ‰è©³ç´°çš„èªªæ˜ï¼Œ(config.callbackç‚ºå¾Œç«¯serverçš„url)

#### ç™»å…¥API

æ–°å¢googleç™»å…¥çš„è·¯ç”±ï¼Œä¹Ÿå°±æ˜¯ç•¶å‰ç«¯æŒ‰ä¸‹ç™»å…¥æŒ‰éˆ•å¾Œè¦æ‰“çš„apiï¼Œé€™é‚Šçš„scopeä»£è¡¨è¦è«‹æ±‚æˆæ¬Šçš„è³‡æ–™ç¯„åœï¼Œå› ç‚ºè³‡æ–™åº«éœ€è¦ç”¨åˆ°ä½¿ç”¨è€…çš„ä¿¡ç®±å’Œå¤§é ­è²¼ï¼Œæ‰€ä»¥éœ€è¦emailå’Œprofileé€™å…©å€‹æ¬„ä½

#### å‰ç«¯å¯¦ä½œ

![](/Users/joectchang_mac/Downloads/medium-export-a/post2022/md_1697073583233/img/1__Wt__ViNg5lkkogreg8dWzsg.png)

é»æ“Šç™»å…¥æŒ‰æ‰­å¾Œï¼Œæœƒè·³è½‰åˆ°å¾Œç«¯å‰›å‰›è¨­å®šçš„çš„${backend}/auth/googleï¼Œpassportæœƒå¹«æˆ‘å€‘è‡ªå‹•å°å‘åˆ° [https://accounts.google.com/o/oauth2/auth](https://accounts.google.com/o/oauth2/auth)çš„googleæˆæ¬Šé é¢

![](/Users/joectchang_mac/Downloads/medium-export-a/post2022/md_1697073583233/img/1__BSeNXeRxQUw8C8C3u7YuGw.jpeg)

#### å¾Œç«¯callback API

![](/Users/joectchang_mac/Downloads/medium-export-a/post2022/md_1697073583233/img/1__FUefjS7S2cgazW4Fc9vd4Q.png)

ç•¶ä½¿ç”¨è€…ç¢ºå®šæˆæ¬Šä¹‹å¾Œï¼Œgoogleå°±æœƒè½‰å€åˆ°æˆ‘å€‘è¨­å®šçš„é€™æ”¯callback apiä¸¦ä¸”æœƒåœ¨queryå¸¶ä¸Šcode

![](/Users/joectchang_mac/Downloads/medium-export-a/post2022/md_1697073583233/img/1__8VLTzHY4ZswN7YGhBraf5g.png)

ä¸Šè¿°çš„ç¨‹å¼ç¢¼çœ‹èµ·ä¾†å¾ˆç°¡å–®ï¼Œä½†å…¶å¯¦ä¸­é–“passportå¹«æˆ‘å€‘è™•ç†æ‰è »å¤šäº‹æƒ…çš„ï¼Œè©³ç´°çš„æ­¥é©Ÿå¦‚ä¸‹

1.  Passportæœƒæ‹¿è‘—å‰›å‰›åœ¨queryå–å¾—çš„codeï¼Œå»è·Ÿgoogleæ‹¿token \[POST\](https://oauth2.googleapis.com/token)
2.  å–å¾—tokenä¹‹å¾Œå†å»è·Ÿgoogleè«‹æ±‚å®Œæ•´çš„ä½¿ç”¨è€…è³‡æ–™\[GET\](https://www.googleapis.com/oauth2/v1/userinfo)
3.  æ‹¿åˆ°è³‡æ–™å¾ŒPassportå°±æœƒåŸ·è¡Œæˆ‘å€‘è‡ªå·±å®šç¾©çš„signInByGoogle callback function

æˆ‘å€‘å¯ä»¥åœ¨reqåƒæ•¸è£¡é¢å–å¾—googleå›å‚³çš„è³‡æ–™(ex: emailã€ nameã€ picture)ç­‰ç­‰ï¼Œå‡è¨­æ˜¯æ–°ç”¨æˆ¶çš„è©±å°±æ–°å¢è³‡æ–™åˆ°DBï¼Œä¸¦ä¸”å»ºç«‹ä¸€çµ„tokençµ¦ä½¿ç”¨è€…ï¼Œè‡³æ–¼tokenè¦æ€éº¼åœ¨è½‰å€çš„æ™‚å€™å‚³çµ¦å‰ç«¯ï¼Œç›®å‰æƒ³åˆ°çš„å…©å€‹æ–¹æ³•æ˜¯å¸¶åœ¨è½‰å€çš„urlä¸Šï¼Œæˆ–æ˜¯ç”¨å¾Œç«¯ç”¨res.cookie(â€˜tokenâ€™, xxxx)çš„æ–¹å¼ï¼ŒæŠŠtokenå­˜åœ¨ç€è¦½å™¨çš„cookieï¼Œå¦‚æœæœ‰å…¶ä»–çš„åšæ³•ï¼Œæ­¡è¿åˆ†äº«çµ¦æˆ‘!

æœ€å¾Œä¸€æ­¥ï¼Œå¾Œç«¯ç”¨res.redirect(å‰ç«¯ç¶²å€)çš„æ–¹å¼è·³è½‰åˆ°ç™»å…¥æˆåŠŸçš„ç•«é¢ï¼Œå°±å¤§åŠŸå‘Šæˆäº†!

ğŸ‘‰ [å¯¦ä½œç¨‹å¼ç¢¼](https://github.com/ChangChiao/task-board-backend)

*   passportç›¸é—œè¨­å®šæ”¾åœ¨config/passport.js
*   routeç›¸é—œè¨­å®šæ”¾åœ¨ routes/auth.route.js
*   ç¬¬ä¸‰æ–¹ç™»å…¥é‚è¼¯æ”¾åœ¨ oauth.service.js